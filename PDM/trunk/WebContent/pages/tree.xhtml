<?xml version="1.0" encoding="iso-8859-2" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">
<head />
<body>
	<ui:composition template="/WEB-INF/templates/standard.xhtml">
		<ui:define name="head" />

		<ui:define name="content">
			<h:form id="mainForm" name="mainForm">
				<div id="bodyarea">
					<div class="left">
						<div class="h7">Drzewo taksonomii</div>
						
						<rich:panel id="treePanel" style="border: 0px;">
							<rich:tree nodeSelectListener="#{treeBean.processSelection}"
								reRender="selectedNode,treePanel,resultsPanel,indexingQualifiers,errors"
								ajaxSubmitSelection="true" switchType="client"
								value="#{treeBean.rootNode}" var="item" id="tree"
								treeNodeVar="treeNodeVar" ajaxKeys="#{null}"
								nodeFace="#{item.face}"
								icon="#{item.parentId == 0 ? 
	                               './/..//..//styles//solitude//images//node.png' : 
	                               './/..//..//styles//solitude//images//folder.jpg'}"
								iconLeaf=".//..//..//styles//solitude//images//leaf2.jpg">


								<rich:treeNode type="standard">
									<font style="background-color: #{item.color};"><h:outputText
											value="#{item.data}" /> </font>
								</rich:treeNode>
								<rich:treeNode type="#{colorGradient.neutralColor}">
									<font style="background-color: #{colorGradient.neutralColor};"><h:outputText
											value="#{item.data}" /> </font>
								</rich:treeNode>
								
								<rich:treeNode type="#{colorGradient.neutralColor}-0">
									<font style="background-color: #{constants.orange0};"><h:outputText
											value="#{item.data}" /> </font>
								</rich:treeNode>
								<rich:treeNode type="#{colorGradient.neutralColor}-1">
									<font style="background-color: #{constants.orange1};"><h:outputText
											value="#{item.data}" /> </font>
								</rich:treeNode>
								<rich:treeNode type="#{colorGradient.neutralColor}-2">
									<font style="background-color: #{constants.orange2};"><h:outputText
											value="#{item.data}" /> </font>
								</rich:treeNode>
								<rich:treeNode type="#{colorGradient.neutralColor}-3">
									<font style="background-color: #{constants.orange3};"><h:outputText
											value="#{item.data}" /> </font>
								</rich:treeNode>
								<rich:treeNode type="#{colorGradient.neutralColor}-4">
									<font style="background-color: #{constants.orange4};"><h:outputText
											value="#{item.data}" /> </font>
								</rich:treeNode>
								<rich:treeNode type="#{colorGradient.neutralColor}-5">
									<font style="background-color: #{constants.orange5};"><h:outputText
											value="#{item.data}" /> </font>
								</rich:treeNode>

								<rich:treeNode type="standard">
									<font style="background-color: #{item.color};"> <h:outputText
											value="#{item.data} kk" /> </font>
								</rich:treeNode>
							</rich:tree>
						</rich:panel>
					</div>

					<div class="right_bg">
						<h:panelGrid id="errors" style="text-align: center; width: 100%;">
							<h:messages errorClass="errorMessage" infoClass="infoMessage"
								warnClass="warnMessage" rendered="true" showSummary="true"
								layout="table" globalOnly="false" showDetail="false"/>
						</h:panelGrid>
						
						<rich:panel id="selectedNode" style="height: 80px;"
							rendered="#{!treeBean.indexingMode}">
							<div class="hometext_linksarea">
								<div class="readmore">Edycja konceptu</div>
							</div>

							<h:panelGrid columns="2">
								<rich:panel style="border: 0px;">
									<a4j:commandButton id="includeBut" value="Do³±cz"
										reRender="mainForm" />
									<br />
									<a4j:commandButton id="excludeBut" value="Wyklucz"
										reRender="mainForm" />
											</rich:panel>

								<rich:panel>
									<table>
										<tr>
											<a4j:repeat value="#{treeBean.concept.selectedConcept}"
												var="token">
												<td><a4j:commandButton id="conceptEditing"
														value="#{token.data}"
														reRender="selectedNode,treePanel,resultsPanel"
														styleClass="#orangeButton"
														style="width: 100px; background: #{token.faceHex};">
														<!--value="#{token.data} [#{token.abstractionIndex}]" 
														onmouseover="this.style.backgroundColor='#FFD900'"
														onmouseout="this.style.backgroundColor='#{a4jSkin.BackgroundColor}'"
														styleClass="#{token.face}Button" 
														style="width: 100px; background: #{token.faceHex};"-->
														<f:attribute name="elementName" value="#{token.data}" />
													</a4j:commandButton>
												</td>
											</a4j:repeat>
											<td><f:view>
													<h:selectOneMenu
														value="#{treeBean.concept.selectedChildText}"
														onchange="submit()" label="Choose to extend this concept"
														rendered="#{treeBean.concept.hasChildren}"
														style="width: 120px;">
														<f:selectItems id="selectItemsClassic"
															value="#{treeBean.concept.conceptChildrenItems}" />
													</h:selectOneMenu>
												</f:view></td>
										</tr>
										<tr align="center">
											<a4j:repeat value="#{treeBean.concept.selectedConcept}"
												var="token">
												<td><a4j:commandLink id="removeTaxElement"
														reRender="selectedNode, treePanel">
													Usuñ„
													<f:attribute name="taxElementName" value="#{token.data}" />
													</a4j:commandLink>
												</td>
											</a4j:repeat>
										</tr>
									</table>
								</rich:panel>
							</h:panelGrid>
						</rich:panel>

						<rich:panel id="ObjectQualifiers" rendered="#{!treeBean.indexingMode}">
							<rich:panel 
								style="border: 0px; margin-bottom: 0px; margin-top: 0px;
									padding-bottom: 0px; padding-top: 0px;">
								<div class="hometext_linksarea">
									<div class="qualifiers">Kwalifikatory obiektów</div>
								</div>
							</rich:panel>

							<ui:repeat value="#{treeBean.conceptHistory}" var="hist">
									<!--<h:outputText class="taxSeparator"
										value="Taksonomia: #{hist.taxonomyName}"
										escape="false" rendered="#{hist.firstFromThisTax}" />-->
							
								<!-- &lt;/br&gt; -->
								<rich:panel rendered="#{hist.firstFromThisTax}" 
										style="border: 0px; margin-bottom: 0px; margin-top: 3px; min-height: 20px;
										padding-bottom: 0px; padding-top: 0px;">
									<div class="taxSeparator">
										<h:outputText value="Taksonomia: &lt;b&gt;#{hist.taxonomyName}&lt;/b&gt;"
										escape="false"
										style="padding-left: 12px; padding-bottom: 0px;"/>
									</div>
								</rich:panel>
								
								<rich:panel id="concept"
									style="border: 0px;
											margin-bottom: 0px; margin-top: 0px; margin-right: 15px; margin-left: 25px;
											padding-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px;">
									<table border="0">
										<tr align="center" valign="middle">
											<td width="80" align="center">
												<div class="conceptActionsEdit">
													<a4j:commandLink id="editHistConcept"
														reRender="selectedNode, treePanel">
													Edytuj
													<f:attribute name="conceptId" value="#{hist.id}" />
													</a4j:commandLink>
												</div>
											</td>
											<ui:repeat value="#{hist.confirmedConcept}" var="concept">
												<td rowspan="2" align="center" valign="middle"><rich:panel
														id="HistoryConceptElement" height="100%"
														style="background-color: #{concept.colorHex}; width: 80px; margin-bottom: 0px; vertical-align: middle;">
														<!--<h:outputText value="#{concept.name} [#{concept.abstractionIndex}]" />-->
														<h:outputText value="#{concept.name}" />
													</rich:panel></td>
											</ui:repeat>
										</tr>
										<tr valign="middle">
											<td width="80" align="center">
												<div class="conceptActionsDelete">
													<a4j:commandLink id="removeHistConcept"
															reRender="ObjectQualifiers, resultsPanel"
															type="submit" action="refresh">
															<!-- onmouseup="submit();" onclick="submit();"
															wersja dla chrome: type="submit" action="refresh">
															wersja dla opery: onclick="submit();" > -->
														Usuñ  
														<f:attribute name="conceptId" value="#{hist.id}" />
													</a4j:commandLink>
												</div>
											</td>
										</tr>
									</table>
								</rich:panel>
							</ui:repeat>
						</rich:panel>

						<rich:panel id="resultsPanel" rendered="#{!treeBean.indexingMode}">
							<rich:panel 
								style="border: 0px; margin-bottom: 0px; margin-top: 0px;
									padding-bottom: 0px; padding-top: 0px;">
								<div class="hometext_linksarea">
									<div class="resultsHeader">Wyniki wyszukiwania</div>
								</div>
							</rich:panel>
							<rich:panel 
										style="border: 0px; margin-bottom: 0px; margin-top: 3px; min-height: 20px;
										padding-bottom: 0px; padding-top: 0px;">
									<div class="taxSeparator">
										<h:outputText value="Wyniki w pe³ni zgodne"
										escape="false"
										style="padding-left: 12px; padding-bottom: 0px;"/>
									</div>
								</rich:panel>
							<rich:dataGrid value="#{treeBean.searchResults}" var="res"
								columns="#{treeBean.searchResultGridFormat}" width="100%" rowKeyVar="row">

								<rich:panel>
									<div class="hometext_linksarea">
										<div class="results">#{res.title}</div>
									</div>
									<rich:effect event="onclick" type="DropOut"
										params="duration:0.8" />
									<h:panelGrid rows="2">

										<a4j:mediaOutput id="med2" element="img"
											mimeType="#{res.file.mime}"
											createContent="#{fileUploadBean.paintObject}"
											value="#{res.file.id}" style="width:100px; height:100px;"
											cacheable="false">
											<f:param value="#{fileUploadBean.timeStamp}" name="time" />
											
										</a4j:mediaOutput>
										#{res.description}
									</h:panelGrid>
								</rich:panel>
								<f:facet name="footer">
								
									<rich:datascroller />

								</f:facet>
							</rich:dataGrid>
							<rich:panel 
										style="border: 0px; margin-bottom: 0px; margin-top: 3px; min-height: 20px;
										padding-bottom: 0px; padding-top: 0px;">
									<div class="taxSeparator">
										<h:outputText value="Wyniki przedzia³owe"
										escape="false"
										style="padding-left: 12px; padding-bottom: 0px;"/>
									</div>
								</rich:panel>
							<rich:dataGrid value="#{treeBean.intervalSearchResults}" var="res"
								columns="#{treeBean.intervalSearchResultGridFormat}" width="100%" rowKeyVar="row">

								<rich:panel>
									<div class="hometext_linksarea">
										<div class="results">#{res.title}</div>
									</div>
									<rich:effect event="onclick" type="DropOut"
										params="duration:0.8" />
									<h:panelGrid rows="2">

										<a4j:mediaOutput id="med2" element="img"
											mimeType="#{res.file.mime}"
											createContent="#{fileUploadBean.paintObject}"
											value="#{res.file.id}" style="width:100px; height:100px;"
											cacheable="false">
											<f:param value="#{fileUploadBean.timeStamp}" name="time" />
											
										</a4j:mediaOutput>
										#{res.description}
									</h:panelGrid>
								</rich:panel>
								<f:facet name="footer">
								
									<rich:datascroller />

								</f:facet>
							</rich:dataGrid>
						</rich:panel>


						<rich:panel id="indexingNewObject"
							rendered="#{treeBean.indexingMode}">
							<div class="hometext_linksarea">
								<div class="qualifiers">Dodawany obiekt</div>
							</div>
							<h:panelGrid columns="1" columnClasses="panelGridToTop"
								styleClass="panelGridToTop">

								<h:panelGrid rows="2" rowClasses="row1,row1">																	

										<rich:inplaceInput value="#{treeBean.addedElement.title}"
											showControls="true" controlsVerticalPosition="bottom"
											controlsHorizontalPosition="left"
											defaultLabel="Tytu³ - kliknij, aby edytowaæ">											
										</rich:inplaceInput>
									
									<rich:inplaceInput value="#{treeBean.addedElement.description}"
										layout="block" defaultLabel="Opis - kliknij, aby edytowaæ" inputWidth="600px" maxInputWidth="600px" />
									
								</h:panelGrid>
								<h:panelGrid columns="2" columnClasses="top,top">
            <rich:fileUpload fileUploadListener="#{fileUploadBean.listener}"
                maxFilesQuantity="#{fileUploadBean.uploadsAvailable}"
                id="upload"
                immediateUpload="#{fileUploadBean.autoUpload}"
                acceptedTypes="jpg, gif, png, bmp" allowFlash="#{fileUploadBean.useFlash}"
                listWidth="470"	listHeight="130"
                addControlLabel="Dodaj plik..." clearAllControlLabel="Wyczy¶æ listê" 
                clearControlLabel="Wyczy¶æ" stopEntryControlLabel="Stop" uploadControlLabel="Dodaj plik" doneLabel="Wykonano" >                
                <a4j:support event="onuploadcomplete" reRender="info"                  
                />
            </rich:fileUpload>
            <h:panelGroup id="info">
                <rich:panel bodyClass="info">
                    
                    <h:outputText value="Brak obrazu"
                        rendered="#{fileUploadBean.size==0}" />
                    <rich:dataGrid columns="1" value="#{fileUploadBean.files}"
                        var="file" rowKeyVar="row">         
                                 <a4j:mediaOutput element="img" mimeType="#{file.mime}"
                                    createContent="#{fileUploadBean.paint}" value="#{row}"
                                    style="width:100px; height:100px;" cacheable="false">
                                    <f:param value="#{fileUploadBean.timeStamp}" name="time"/>  
                                </a4j:mediaOutput> 
                    </rich:dataGrid>
                </rich:panel>
                <rich:spacer height="3"/>
                <br />
                <a4j:commandButton id="clearUploadData" 
                    reRender="info, upload" value="Usuñ obraz"
                    rendered="#{fileUploadBean.size>0}" />
            </h:panelGroup>
        </h:panelGrid>




							</h:panelGrid>
						</rich:panel>



						<rich:panel id="indexingQualifiers"
							rendered="#{treeBean.indexingMode}">
							<rich:panel 
								style="border: 0px; margin-bottom: 0px; margin-top: 0px;
									padding-bottom: 0px; padding-top: 0px;">
								<div class="hometext_linksarea">
									<div class="resultsHeader">Dodawany obiekt - wybrane taksonomie</div>
								</div>
							</rich:panel>
							<ui:repeat value="#{treeBean.selectedTaxElements}" var="el">
							<rich:panel 
										style="border: 0px; margin-bottom: 0px; margin-top: 3px; min-height: 20px;
										padding-bottom: 0px; padding-top: 0px;">
									<div class="taxSeparator">
										<h:outputText value="  "
										escape="false"
										style="padding-left: 12px; padding-bottom: 0px;"/>
									</div>
								</rich:panel>



								<rich:panel id="selectedTaxPanel"
									style="border: 0px;
														margin-bottom: 0px; margin-top: 0px; margin-right: 15px; margin-left: 15px;
														padding-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px;">
														
														
									<table border="0">
										<tr align="center" valign="middle">
											<td width="80" align="center"/>
											


											<ui:repeat value="#{el.parentTree}" var="v">
												<td rowspan="2" align="center" valign="middle"><rich:panel
														id="IndexingElement" height="100%"
														style="background-color: #{v.color}; width: 80px; margin-bottom: 0px; vertical-align: middle;">
														<h:outputText value="#{v.data}" />
													</rich:panel>
												</td>
											</ui:repeat>
										</tr>
										<tr valign="middle">
											<td width="80" align="center">
											</td>
										</tr>
									</table>
									
								</rich:panel>
							</ui:repeat>
							<div align="center">
									<a4j:commandButton id="savingSearchResultButton" value="Zapisz"
							reRender="mainForm" /> </div>
						</rich:panel>
					</div>
				</div>


			</h:form>
		</ui:define>
	</ui:composition>
</body>
</html>